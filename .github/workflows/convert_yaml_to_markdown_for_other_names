name: Convert Secretaries of State YAML to Markdown

on:
  push:
    paths:
      - 'first-sector-data-sets/secretaries_of_state/other_names.yaml'

permissions:
  contents: write

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install PyYAML
        run: pip install pyyaml

      - name: Convert YAML to Markdown List
        run: |
          python3 <<EOF
          import yaml

          all_names = []
          with open('first-sector-data-sets/secretaries_of_state/other_names.yaml', 'r') as f:
              data = yaml.safe_load(f)

          # Extract all list items (values) from the YAML data
          if data:
              for name_list in data.values():
                  if isinstance(name_list, list):
                      all_names.extend(str(name).strip() for name in name_list)

          # Sort the final list alphabetically
          all_names.sort()

          # Create the Markdown content with an updated warning
          md = "\\n\\n"
          md += "# Alternative Names for Secretaries of State\\n\\n"
          for name in all_names:
              md += f"- {name}\\n"

          # Write to the Markdown file
          with open('secretaries_of_state/other_names.md', 'w') as f:
              f.write(md)
          EOF

      - name: Commit Markdown file
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}
          git add secretaries_of_state/other_names.md
          git status
          git commit -m "docs: update 'other names' list from YAML" || echo "No changes to commit"
          git push origin HEAD
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
